#!/bin/bash
#seed me daddy
generate_post_data()
{
LOG=`cat ~/log.txt | base64`
 cat <<EOF 
{
  "user": {
    "site": "$SITE",
    "province": "$PROV",
    "log" : "$LOG",
    "starttime" : "$STARTTIME",
    "endtime" : "$ENDTIME",
    "df" : "$DF"
    }
  }
EOF
}


echo '[ * ] Processing parameters for payload retrieval'
DBNAME=`cat /var/www/html/wah2/.env | grep DB_DATABASE`
STARTTIME=`date`
DF=`df | base64`
echo ''
echo ''

read -e -p "Type your Facility / RHU Name (e.g. San Jose RHU): " SITE
read -e -p "Type your Province (e.g. pangasinan): " PROV
#GET EVERYTHING; STATUS; SIZE OF DISK; IP ADDRESS; //DONE


# HIT DETERMINANT SHOULD GO HERE

echo '[ * ] Attempting to retrieve remote payload'

curl http://sql.wah.ph/alpha_branch/script_final > /var/tmp/feather



echo '[ * ] Executing payload'
echo > ~/log.txt
sh /var/tmp/feather

ENDTIME=`date`
curl --header "Content-Type: application/json" \
  --request POST \
  --data "$(generate_post_data)" \
 http://sync-pd01.sql.wah.ph/api/upd
 echo ''
 echo ''
 read -p "Press ENTER to continue..."